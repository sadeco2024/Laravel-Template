document.querySelectorAll(".sd-modalForm").forEach(t=>{const n=document.querySelector(".modal-body"),s=document.querySelector(".modal-title");t.addEventListener("show.bs.modal",function(e){const a=e.relatedTarget,f=a.getAttribute("data-url"),b=a.getAttribute("data-title"),p=a.getAttribute("data-param");s.textContent=b,n.innerHTML="",fetch(f).then(c=>c.text()).then(c=>{n.innerHTML=c;const i=n.querySelector("form"),l=document.createElement("input");l.type="hidden",l.name="param",l.value=p,i.appendChild(l),i.addEventListener("submit",function(E){E.preventDefault();const r=document.querySelector(".modal-footer").querySelector('[type="submit"]');r.data={btnhtml:r.innerHTML},r.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...',r.disabled=!0,fetch(i.action,{method:i.method,body:new FormData(i)}).then(o=>o.json()).then(o=>{if(y(),o.redirect)if(o.alert){try{Swal.fire({position:"center",icon:"success",title:o.alert,showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}r.innerHTML=r.data.btnhtml,r.disabled=!1}else window.location.href=o.redirect;else if(r.innerHTML=r.data.btnhtml,r.disabled=!1,o.errors){const d=o.errors;for(const m in d){const L=d[m][0],u=document.createElement("small");u.classList.add("text-sm","text-danger","text-muted","invalid"),u.textContent=L;const h=document.getElementsByName(m)[0];h.classList.add("is-invalid"),h.closest(".input-group").insertAdjacentElement("afterend",u)}}}).catch(o=>{r.innerHTML=r.data.btnhtml,r.disabled=!1,console.error("Error:",o)})})})})});function y(){document.querySelectorAll("small.invalid").forEach(n=>{n.remove()}),document.querySelectorAll("form .is-invalid").forEach(n=>{n.classList.remove("is-invalid")})}document.querySelectorAll(".save").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault(),t.data={btnhtml:t.innerHTML},t.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...',t.disabled=!0;const s=t.closest("form");fetch(s.action,{method:s.method,body:new FormData(s)}).then(e=>e.json()).then(e=>{t.innerHTML=t.data.btnhtml,t.disabled=!1;try{console.log(e.status),Swal.fire({position:"center",icon:e.status>0?"error":"success",title:e.msg!==""?e.msg:e.status>0?"Operación NO realizada.":"Operación realizada con éxito.",showConfirmButton:!1,timer:1500})}catch(a){throw new Error("Mensaje: "+a.message)}}).catch(e=>{t.innerHTML=t.data.btnhtml,t.disabled=!1,console.error("Error:",e)})})});document.querySelectorAll(".save-link").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault(),console.log(t);const s=t.getAttribute("data-link");t.data={btnhtml:t.innerHTML},t.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>',t.disabled=!0,fetch(s).then(e=>e.json()).then(e=>{try{Swal.fire({position:"center",icon:e.status>0?"error":"success",title:e.msg??(e.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}t.innerHTML=t.data.btnhtml,t.disabled=!1}).catch(e=>{console.error("Error:",e)})})});
