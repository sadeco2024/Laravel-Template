import{a as A}from"./axios-zOJ20UaM.js";window.saveLink=function(e){const n=e.getAttribute("data-link");e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>',e.disabled=!0,A.get(n).then(t=>{console.log(t.data),t=t.data,e.innerHTML=e.data.btnhtml,e.disabled=!1,t.form&&w(t),t.table&&C(t.table),v(t)}).catch(t=>{console.error("Error:",t),v(t)})};function w(e){if(e.form&&typeof e.form=="object")for(let n in e.form){let t=e.form[n];document.getElementsByName(n)[0].value=t}else throw new Error("Funciones::Error: No se recibió ningún formulario")}function C(e){if(console.log(e),e&&typeof e=="object"){console.log(e,typeof e);for(let n in e){let o=document.getElementById(n).getElementsByTagName("tbody")[0];if(Array.isArray(e[n]))e[n].forEach(a=>{let r=o.insertRow();for(let s in a){let i=r.insertCell();i.innerHTML=a[s]}});else if(typeof e[n]=="object"){e[n]=Object.values(e[n]);let a=o.insertRow();e[n].forEach(r=>{let s=a.insertCell();s.innerHTML=r})}else throw console.log("type:",typeof e),new Error("Error: El tipo de dato no es un array o un objeto")}}}function v(e){console.log("funciones::alert",e);try{Swal.fire({position:"center",icon:e.status>0?"error":"success",title:e.msg!==""?e.msg:e.status>0?"Operación NO realizada.":"Operación realizada con éxito.",showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}}document.querySelectorAll(".sd-modalForm").forEach(e=>{const n=document.querySelector(".modal-body"),t=document.querySelector(".modal-title");e.addEventListener("show.bs.modal",function(o){const a=o.relatedTarget,r=a.getAttribute("data-url"),s=a.getAttribute("data-title"),i=a.getAttribute("data-param");t.textContent=s,n.innerHTML="",fetch(r).then(l=>l.text()).then(l=>{n.innerHTML=l;const c=n.querySelector("form"),u=document.createElement("input");if(u.type="hidden",u.name="param",u.value=i,!c)throw new Error("Error: Falta el <form> en la vista");c.appendChild(u),c.addEventListener("submit",function(f){f.preventDefault();const p=document.querySelector(".modal-footer").querySelector('[type="submit"]');p.data={btnhtml:p.innerHTML},p.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Procesando...',p.disabled=!0,fetch(c.action,{method:c.method,body:new FormData(c)}).then(d=>d.json()).then(d=>{if(D(c),d.table&&L(d.table),d.errors&&F(d.errors),d.redirect&&(window.location.href=d.redirect),d.datatable){const S=$("#tblTelcelCanales").DataTable();T(S,d.datatable)}y(d),console.log("form",d),p.innerHTML=p.data.btnhtml,p.disabled=!1}).catch(d=>{p.innerHTML=p.data.btnhtml,p.disabled=!1,y(d)})})})})});function T(e,n){e.row(n.id-1).data(),e.row(n.id-1).data(n)}function D(e){e.querySelectorAll("small.invalid").forEach(t=>{t.remove()}),e.querySelectorAll("form .is-invalid").forEach(t=>{t.classList.remove("is-invalid")})}function L(e){if(console.log(e),e&&typeof e=="object"){console.log(e,typeof e);for(let n in e){let o=document.getElementById(n).getElementsByTagName("tbody")[0];if(Array.isArray(e[n]))e[n].forEach(a=>{let r=o.insertRow();for(let s in a){let i=r.insertCell();i.innerHTML=a[s]}});else if(typeof e[n]=="object"){e[n]=Object.values(e[n]);let a=o.insertRow();e[n].forEach(r=>{let s=a.insertCell();s.innerHTML=r})}else throw console.log("type:",typeof e),new Error("Error: El tipo de dato no es un array o un objeto")}}}function y(e){e.status=e.status??1;let n=e.msg??e.alert??(e.status==0?"Operación NO realizada.":"Operación realizada con éxito.");try{Swal.fire({position:"center",icon:e.status>0?"error":"success",title:n,showConfirmButton:!1,timer:1500})}catch{throw new Error("Alert::error: Falta librería SweetAlerts2")}}function F(e){for(const n in e){const t=e[n][0],o=document.createElement("small");o.classList.add("text-sm","text-danger","text-muted","invalid"),o.textContent=t;const a=document.getElementsByName(n)[0];a.classList.add("is-invalid"),a.closest(".input-group").insertAdjacentElement("afterend",o)}}document.querySelectorAll(".save").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault(),e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...',e.disabled=!0;const t=e.closest("form");fetch(t.action,{method:t.method,body:new FormData(t)}).then(o=>o.json()).then(o=>{e.innerHTML=e.data.btnhtml,e.disabled=!1;try{Swal.fire({position:"center",icon:o.status>0?"error":"success",title:o.msg!==""?o.msg:o.status>0?"Operación NO realizada.":"Operación realizada con éxito.",showConfirmButton:!1,timer:1500})}catch(a){throw new Error("Mensaje: "+a.message)}}).catch(o=>{e.innerHTML=e.data.btnhtml,e.disabled=!1,console.error("Error:",o)})})});document.querySelectorAll(".save-link").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const t=e.getAttribute("data-link");e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>',e.disabled=!0,fetch(t).then(o=>o.json()).then(o=>{try{Swal.fire({position:"center",icon:o.status>0?"error":"success",title:o.msg??(o.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}e.innerHTML=e.data.btnhtml,e.disabled=!1}).catch(o=>{console.error("Error:",o)})})});document.querySelectorAll("input.daterange").forEach(e=>{try{flatpickr(e,{mode:"range",dateFormat:"d-m-Y",locale:"es"})}catch{throw"Error al cargar el Datepicker"}});document.querySelectorAll(".confirm-delete").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();let t=e.closest("form");try{Swal.fire({title:e.dataset.title||"¿Esta usted seguro?",text:e.dataset.text||"Esta acción no se puede deshacer",icon:e.dataset.icon||"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:e.dataset.btntext||"Eliminar"}).then(o=>{o.isConfirmed&&(Swal.fire("Eliminado!","El registro ha sido eliminad.","success"),t.submit())})}catch{throw new Error("Error: Falta librería SweetAlerts2")}})});document.querySelectorAll(".rhExtras").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();let t=e.closest("div.input-group");t=t.querySelector("select");const o=document.querySelector('meta[name="csrf-token"]').getAttribute("content");Swal.fire({title:"¿Nombre del "+e.dataset.concepto+"?",input:"text",inputAttributes:{autocapitalize:"on"},showCancelButton:!0,confirmButtonText:"Guardar",showLoaderOnConfirm:!0,preConfirm:a=>fetch("/generales/setRhExtras",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({concepto:e.dataset.concepto,descripcion:a})}).then(r=>r.ok?r.json():r.json().then(s=>{throw console.log(s.message),new Error(s.message)})).catch(r=>{Swal.showValidationMessage(`${r}`)}),allowOutsideClick:()=>!Swal.isLoading()}).then(a=>{if(a.isConfirmed){Swal.fire({position:"center",icon:"success",title:"El concepto ha sido agregado.",showConfirmButton:!1,timer:1500});let r=document.createElement("option");r.text=a.value.descripcion,r.value=a.value.id,t.add(r),t.value=a.value.id}})})});var x={series:[{name:"Kits",data:[44,55,41,42,22,43,21,35,56,27,43,27]},{name:"Chips",data:[33,21,32,37,23,32,47,31,54,32,20,38]},{name:"Portas",data:[30,25,36,30,45,35,64,51,59,36,39,51]},{name:"Otros",data:[2,0,0,1,1,2,0,0,3,4,1,5]}],chart:{type:"bar",height:360,fontFamily:"Poppins, sans-serif",foreColor:"#8c9097",stacked:!0,toolbar:{show:!1},zoom:{enabled:!0}},grid:{borderColor:"#90A4AE",strokeDashArray:2},dataLabels:{enabled:!1},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],stroke:{show:!0,width:[5,5,5,5],curve:"smooth"},plotOptions:{bar:{columnWidth:"10%",horizontal:!1}},legend:{position:"right",offsetY:40},fill:{opacity:1},legend:{show:!1},tooltip:{enabled:!0,shared:!0,intersect:!1},labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},x={series:[44,55,13,43],chart:{width:220,height:220,type:"pie"},colors:["var(--primary08)","rgba(69, 214, 91, 0.8)","rgba(243, 156, 18, 0.8)","rgba(231, 76, 60, 0.8)"],labels:["Mobile","Desktop","Laptop","Tablet"],legend:{show:!1},stroke:{width:0},dataLabels:{enabled:!0,dropShadow:{enabled:!1}}};if(document.querySelector("#leads-source")){var M=new ApexCharts(document.querySelector("#leads-source"),x);M.render()}(function(){if(document.getElementById("tblTelcelCanales")){var e=$("#tblTelcelCanales").data("url");const n=$("#tblTelcelCanales").DataTable({dom:"Brtip",buttons:["copy","excel","print"],pageLength:10,ajax:{url:e,dataSrc:""},scrollX:!0,columns:[{data:"nombre"},{data:"clave",render:function(t,o,a){return`<span class="badge border bg-light text-default custom-badge px-2">${a.clave}</span>`}},{data:"acox"},{data:"concepto.concepto"},{data:"sucursal.nombre"},{data:"sucursal.empleados",render:function(t,o,a){return t.length}},{data:null,render:function(t,o,a){return`
                        <div class="btn-group btn-group-sm">
                            <a class="modal-effect btn btn-sm btn-outline-${a.question==1?"success":"warning"} waves-effect waves-light"
                                data-bs-effect="effect-slide-in-right" 
                                data-bs-toggle="modal" 
                                href="#modalCanales" 
                                data-url="${a.ruta_editar}"
                                data-title="Editar canal"
                                data-param="${a.id}"
                            >
                                <i class="bi bi-gear"></i>
                            </a>
               
                        </div>
                        `}}],columnDefs:[{targets:3,className:"text-center",render:function(t,o,a,r){let s=a.concepto.concepto==="Distribuidor"?"primary":a.concepto.concepto==="Subs"?"success":"warning";return s=a.id==1?"danger":s,`
                        <span class="badge bg-${s}-transparent" />
                            ${a.concepto.concepto}
                        </span>
                        `}}]});O(n,"src_telcel_canal","btnTelcelCanales")}})();function O(e,n,t){$("thead",e).addClass("text-info"),$(".pagination",e).addClass("my-2"),Array.from(e.buttons().nodes()).forEach(a=>{a.classList.remove("btn-secondary"),a.classList.add("btn-sm","btn-outline-info","btn-wave","waves-effect","waves-light")}),e.buttons().container().appendTo("#"+t),$("#"+n).val("").on("keyup",function(){e.search(this.value).draw()})}function k(e){let n="";switch(e){case"Suspendido":n="warning";break;case"Baja":n="danger";break;default:n="success";break}return n}if(document.getElementById("tblEmpleados")){const e=$("#tblEmpleados").DataTable({dom:"Brtip",buttons:["copy","excel","print"],pageLength:10,resposive:!0,columnDefs:[{targets:3,render:function(t,o,a,r){return`
                    <span class="badge bg-${k(a[3])}-transparent" />
                        ${a[3]}
                    </span>
                    `}}]});Array.from(e.buttons().nodes()).forEach(t=>{t.classList.remove("btn-secondary"),t.classList.add("btn-sm","btn-outline-info","btn-wave","waves-effect","waves-light")}),$("thead",e.table).addClass("text-info"),$(".pagination",e.table).addClass("my-2"),e.buttons().container().appendTo("#tblEmpleadosBtn"),$("#tblEmpleadosInput").on("keyup",function(){e.search(this.value).draw()})}(function(){const e=document.querySelector("#slcActivacionesAnio"),n=document.querySelector("#slcActivacionesMes"),t=document.querySelector("#slcActivacionesFecha");e.selectedIndex=0,n.selectedIndex=new Date().getMonth(),t.selectedIndex=0,e&&t&&(e.addEventListener("change",o=>{b(o.target.value,n.value,t.value),h(o.target.value,n.value,t.value)}),t.addEventListener("change",o=>{b(e.value,n.value,o.target.value),h(e.value,o.target.value,t.value)}),b(e.value,t.value)),n&&(n.addEventListener("change",o=>{h(e.value,o.target.value,t.value)}),h(e.value,n.value,t.value))})();function h(e,n,t){const o=document.querySelector('meta[name="csrf-token"]').getAttribute("content");fetch("/telcel/activaciones/grafica/diario",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({anio:e??new Date().getFullYear(),mes:n??new Date().getMonth(),tipofecha:t??"preactivacion"})}).then(a=>a.json()).then(a=>{const r=Math.max(...Object.values(a).map(c=>c.data.length)),s=Array.from({length:r},(c,u)=>u+1),i=j(a,r);var l=N(i,s);g("#grafica-activaciones-diario",i,l)}),fetch("/telcel/activaciones/comparadiario",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({anio:e??new Date().getFullYear(),mes:n??new Date().getMonth(),tipofecha:t??"preactivacion"})}).then(a=>a.json()).then(a=>{const r=document.getElementById("compara-mensual-diario");r.innerHTML="";const s=e.toString(),i=(parseInt(s)-1).toString(),l=a[s]||[],c=a[i]||[];l.forEach(u=>{const f=c.find(m=>m.tipo_activa===u.tipo_activa);f&&(u.anio_anterior=f.total)}),r.innerHTML=l.length==0?q(c):B(l)})}function j(e,n){const t=[];return Object.values(e).forEach(o=>{for(;o.data.length<n;)o.data.push(0);(o.concepto==="Distribuidor"||o.concepto==="Subs")&&t.push({name:o.concepto+" "+o.name,data:o.data})}),t}function N(e,n){let t=[],o=[],a=[];const r=new Date().getFullYear().toString(),s=(parseInt(r)-1).toString();return e.forEach((i,l)=>{i.name.includes(s)?(o.push(3),a.push(6),i.name.includes("Distribuidor")?t.push("#78B8E3"):t.push("#C6DE91")):(o.push(4),a.push(0),i.name.includes("Distribuidor")?t.push("#2374AB"):t.push("#9BC53D"))}),{series:e,chart:{height:320,type:"line",zoom:{enabled:!1},animations:{enabled:!1},toolbar:{show:!1}},grid:{borderColor:"#f2f5f7"},stroke:{width:o,curve:"straight",dashArray:a},colors:t,labels:n,xaxis:{labels:{show:!0,style:{colors:"#8c9097",fontSize:"11px",fontWeight:600,cssClass:"apexcharts-xaxis-label"}}},yaxis:{labels:{show:!0,style:{colors:"#8c9097",fontSize:"11px",fontWeight:600,cssClass:"apexcharts-yaxis-label"}}},noData:{text:"No hay datos para mostrar"}}}function g(e,n,t){const o=document.querySelector(e);o.chartInstance?o.chartInstance.updateOptions(t):(o.chartInstance=new ApexCharts(document.querySelector(e),t),o.chartInstance.render())}function B(e){return e.map((t,o)=>{let a=t.total>t.anio_anterior?((t.total-t.anio_anterior)/t.anio_anterior*100).toFixed(2):((t.anio_anterior-t.total)/t.anio_anterior*100).toFixed(2);return a=isNaN(a)?0:a,t.total=Intl.NumberFormat("es-MX",{maximumFractionDigits:0}).format(t.total),`
        <div class="d-flex align-items-center me-5">
        <span class="fs-8 text-secondary">
            <i class="mdi mdi-circle"></i>
    
        </span>
        <div class="ms-2 align-content-top  text-center">
            <p class="mb-0 fs-15">${t.total}</p>
            <p class="mb-0 me-2 fs-13 text-muted">${t.tipo_activa}</p>
                <span class="fs-12 text-${t.total>t.anio_anterior||a==0?"success":"danger"} d-inline-flex align-items-center"
                    title="Año anterior: ${t.anio_anterior??0}">
                    <i class="ti ti-trending-${t.total>t.anio_anterior||a==0?"up":"down"} me-1"></i>
                    ${a}%
                </span>
            </div>
        </div>           
        `}).join("")}function q(e){return e.map((t,o)=>(t.total=Intl.NumberFormat("es-MX",{maximumFractionDigits:0}).format(t.total),`
        <div class="d-flex align-items-center me-5">
        <div class="align-content-top  text-center">
            <p class="mb-0 fs-15">${t.total}</p>
            <p class="mb-0 me-2 fs-13 text-muted">${t.tipo_activa}</p>
                <span class="fs-11 text-danger d-inline-flex align-items-center">
                    Año anterior
                    
                </span>
            </div>
        </div>           
        `)).join("")}function b(e,n,t){document.querySelector("#grafica-activaciones-mensuales");const o=document.querySelector('meta[name="csrf-token"]').getAttribute("content");fetch("/telcel/activaciones/grafica",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({anio:e??new Date().getFullYear(),tipofecha:t??"preactivacion",cadenas:!1})}).then(a=>a.json()).then(a=>{const r=a.map(i=>({name:i.concepto,data:i.data}));g("#grafica-activaciones-mensuales",r,E(r,["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]))}),fetch("/telcel/activaciones/grafica",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({anio:e??new Date().getFullYear(),tipofecha:t??"preactivacion",cadenas:!0})}).then(a=>a.json()).then(a=>{const r=a.map(i=>({name:i.concepto,data:i.data}));g("#grafica-activaciones-mensuales-cadenas",r,E(r,["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]))}),fetch("/telcel/activaciones/compara",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({anio:e??new Date().getFullYear(),tipofecha:t??"preactivacion"})}).then(a=>a.json()).then(a=>{console.log("compara:",a);const r=document.getElementById("compara-mensual-anual");r.innerHTML="";const s=e.toString(),i=(parseInt(s)-1).toString(),l=a[s]||[],c=a[i]||[];console.log("data currrent:",l),console.log(typeof l),Object.values(l).forEach(u=>{const f=Object.values(c).find(m=>m.concepto===u.concepto);f&&(u.anio_anterior=f.total)}),console.log(l),r.innerHTML=H(l)}),fetch("/telcel/activaciones/resumen",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({anio:e??new Date().getFullYear(),mes:n??new Date().getMonth(),tipofecha:t??"preactivacion"})}).then(a=>a.json()).then(a=>{console.log("resumen",a);const r=document.getElementById("spnTotalActivas"),s=document.getElementById("liActivaSucursales");s.innerHTML="",r.innerHTML=a.totalActivaciones,a.results.forEach(i=>{const l=document.createElement("li");l.classList.add("mb-2");let c=`
                            <div class="d-flex align-items-center flex-wrap">
                    
                            <div class="flex-fill">
                                <span class="fs-14 d-block mb-1">   ${i.sucursal}</span>
                                <span class="text-muted fs-12"></span>
                            </div>
                            <div>
                                <span class="bg-success-transparent">   ${i.total}</span>
                            </div>
                        </div>
                    `;l.innerHTML=c,s.appendChild(l)})})}function H(e){return console.log("analisis",e),Object.values(e).map((t,o)=>{let a=t.total>t.anio_anterior?((t.total-t.anio_anterior)/t.anio_anterior*100).toFixed(2):((t.anio_anterior-t.total)/t.anio_anterior*100).toFixed(2);return a=isNaN(a)?0:a,`
        <div class="d-flex align-items-center me-5">
        <span class="fs-8 text-secondary">
            <i class="mdi mdi-circle"></i>
    
        </span>
        <div class="ms-2 align-content-top  text-center">
            <p class="mb-0 fs-15">${Intl.NumberFormat("es-MX",{maximumFractionDigits:0}).format(t.total)}</p>
            <p class="mb-0 me-2 fs-13 text-muted">${t.concepto}</p>
                <span class="fs-12 text-${t.total>t.anio_anterior||a==0?"success":"danger"} d-inline-flex align-items-center"
                    title="Año anterior: ${t.anio_anterior??0}">
                    <i class="ti ti-trending-${t.total>t.anio_anterior||a==0?"up":"down"} me-1"></i>
                    ${a}%
                </span>
            </div>
        </div>           
        `}).join("")}function E(e,n){return{series:e,chart:{type:"bar",height:360,fontFamily:"Poppins, sans-serif",foreColor:"#8c9097",stacked:!0,toolbar:{show:!1},zoom:{enabled:!1}},grid:{borderColor:"#90A4AE",strokeDashArray:2},dataLabels:{enabled:!1},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],stroke:{show:!0,width:[5,5,5,5,5,5,5,5,5,5],curve:"smooth"},plotOptions:{bar:{columnWidth:"30%",horizontal:!1}},legend:{position:"right",offsetY:40},fill:{opacity:1},legend:{show:!0},tooltip:{enabled:!0,shared:!0,intersect:!1},colors:["#2374AB","#BFC0C0","#379634","#573D1C","#7D387D","#9ED8DB","#D58936","#FFB2E6","#A44200","#800080","#FF0000"],labels:n,noData:{text:"No hay datos para mostrar"}}}document.querySelectorAll("textarea.noenter").forEach(e=>{e.addEventListener("keydown",n=>{n.key==="Enter"&&n.preventDefault()})});document.querySelectorAll('[type="submit"].btn-submit').forEach(e=>{e.addEventListener("click",n=>{e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span> Guardando...',e.disabled=!0,e.closest("form").submit()}),console.log(e)});document.querySelectorAll("input.importe").forEach(e=>{e.addEventListener("input",n=>{const t=n.target.value;/^[0-9.]*$/.test(t)||(n.target.value=t.replace(/[^0-9.]/g,""))})});document.querySelectorAll("input.numeros").forEach(e=>{e.addEventListener("input",n=>{const t=n.target.value;/^[0-9]*$/.test(t)||(n.target.value=t.replace(/[^0-9]/g,""));const a=n.target.getAttribute("maxlength");a&&t.length>a&&(n.target.value=t.slice(0,a))})});document.querySelectorAll("input.upper").forEach(e=>{e.addEventListener("input",n=>{const t=n.target.value;n.target.value=t.toUpperCase()})});
