window.saveLink=function(e){console.log(e);const r=e.getAttribute("data-link");e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>',e.disabled=!0,fetch(r).then(t=>t.json()).then(t=>{if(console.log(t,t.status),t.form&&typeof t.form=="object")for(let o in t.form){let a=t.form[o];document.getElementsByName(o)[0].value=a}if(t.table&&typeof t.table=="object")for(let o in t.table){let s=document.getElementById(o).getElementsByTagName("tbody")[0];s.innerHTML="",Array.isArray(t.table[o])&&t.table[o].forEach(l=>{let p=s.insertRow();for(let m in l){let u=p.insertCell();u.innerHTML=l[m]}})}try{Swal.fire({position:"center",icon:t.status>0?"error":"success",title:t.msg??(t.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}e.innerHTML=e.data.btnhtml,e.disabled=!1}).catch(t=>{console.error("Error:",t)})};document.querySelectorAll(".sd-modalForm").forEach(e=>{const r=document.querySelector(".modal-body"),t=document.querySelector(".modal-title");e.addEventListener("show.bs.modal",function(o){const a=o.relatedTarget,s=a.getAttribute("data-url"),l=a.getAttribute("data-title"),p=a.getAttribute("data-param");t.textContent=l,r.innerHTML="",fetch(s).then(m=>m.text()).then(m=>{r.innerHTML=m;const u=r.querySelector("form"),g=document.createElement("input");if(g.type="hidden",g.name="param",g.value=p,!u)throw new Error("Error: Falta el <form> en la vista");u.appendChild(g),u.addEventListener("submit",function(v){v.preventDefault();const i=document.querySelector(".modal-footer").querySelector('[type="submit"]');i.data={btnhtml:i.innerHTML},i.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...',i.disabled=!0,fetch(u.action,{method:u.method,body:new FormData(u)}).then(n=>n.json()).then(n=>{if(console.log(n),L(),n.table&&typeof n.table=="object"){console.log(n.table,typeof n.table);for(let c in n.table){let b=document.getElementById(c);console.log("render",b);let h=b.getElementsByTagName("tbody")[0];if(h.innerHTML="",Array.isArray(n.table[c]))n.table[c].forEach(d=>{let f=h.insertRow();console.log("row:",f);for(let y in d){let w=f.insertCell();w.innerHTML=d[y]}});else if(typeof n.table[c]=="object"){console.log(Object.values(n.table[c])),n.table[c]=Object.values(n.table[c]);let d=h.insertRow();n.table[c].forEach(f=>{console.log("row:",d);let y=d.insertCell();y.innerHTML=f})}else console.log("type:",typeof n.table)}}if(n.alert){try{Swal.fire({position:"center",icon:n.status>0?"error":"success",title:n.msg??(n.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}i.innerHTML=i.data.btnhtml,i.disabled=!1}if(n.redirect)n.alert||(window.location.href=n.redirect);else if(i.innerHTML=i.data.btnhtml,i.disabled=!1,n.errors){const c=n.errors;for(const b in c){const h=c[b][0],d=document.createElement("small");d.classList.add("text-sm","text-danger","text-muted","invalid"),d.textContent=h;const f=document.getElementsByName(b)[0];f.classList.add("is-invalid"),f.closest(".input-group").insertAdjacentElement("afterend",d)}}}).catch(n=>{i.innerHTML=i.data.btnhtml,i.disabled=!1,console.error("Error:",n)})})})})});function L(){document.querySelectorAll("small.invalid").forEach(r=>{r.remove()}),document.querySelectorAll("form .is-invalid").forEach(r=>{r.classList.remove("is-invalid")})}document.querySelectorAll(".save").forEach(e=>{e.addEventListener("click",r=>{r.preventDefault(),e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...',e.disabled=!0;const t=e.closest("form");fetch(t.action,{method:t.method,body:new FormData(t)}).then(o=>o.json()).then(o=>{e.innerHTML=e.data.btnhtml,e.disabled=!1;try{console.log(o.status),Swal.fire({position:"center",icon:o.status>0?"error":"success",title:o.msg!==""?o.msg:o.status>0?"Operación NO realizada.":"Operación realizada con éxito.",showConfirmButton:!1,timer:1500})}catch(a){throw new Error("Mensaje: "+a.message)}}).catch(o=>{e.innerHTML=e.data.btnhtml,e.disabled=!1,console.error("Error:",o)})})});document.querySelectorAll(".save-link").forEach(e=>{e.addEventListener("click",r=>{r.preventDefault(),console.log(e);const t=e.getAttribute("data-link");e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>',e.disabled=!0,fetch(t).then(o=>o.json()).then(o=>{try{Swal.fire({position:"center",icon:o.status>0?"error":"success",title:o.msg??(o.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}e.innerHTML=e.data.btnhtml,e.disabled=!1}).catch(o=>{console.error("Error:",o)})})});document.querySelectorAll("input.daterange").forEach(e=>{try{flatpickr(e,{mode:"range",dateFormat:"d-m-Y",locale:"es"})}catch{throw"Error al cargar el datepicker"}});document.querySelectorAll(".confirm-delete").forEach(e=>{e.addEventListener("click",r=>{r.preventDefault();let t=e.closest("form");try{Swal.fire({title:e.dataset.title||"¿Esta usted seguro?",text:e.dataset.text||"Esta acción no se puede deshacer",icon:e.dataset.icon||"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:e.dataset.btntext||"Eliminar"}).then(o=>{o.isConfirmed&&(Swal.fire("Eliminado!","El registro ha sido eliminad.","success"),t.submit())})}catch{throw new Error("Error: Falta librería SweetAlerts2")}})});document.querySelectorAll(".rhExtras").forEach(e=>{e.addEventListener("click",r=>{r.preventDefault();let t=e.closest("div.input-group");t=t.querySelector("select");const o=document.querySelector('meta[name="csrf-token"]').getAttribute("content");Swal.fire({title:"¿Nombre del "+e.dataset.concepto+"?",input:"text",inputAttributes:{autocapitalize:"on"},showCancelButton:!0,confirmButtonText:"Guardar",showLoaderOnConfirm:!0,preConfirm:a=>fetch("/generales/setRhExtras",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({concepto:e.dataset.concepto,descripcion:a})}).then(s=>s.ok?s.json():s.json().then(l=>{throw console.log(l.message),new Error(l.message)})).catch(s=>{Swal.showValidationMessage(`${s}`)}),allowOutsideClick:()=>!Swal.isLoading()}).then(a=>{if(a.isConfirmed){Swal.fire({position:"center",icon:"success",title:"El concepto ha sido agregado.",showConfirmButton:!1,timer:1500});let s=document.createElement("option");s.text=a.value.descripcion,s.value=a.value.id,t.add(s),t.value=a.value.id}})})});var E={series:[{name:"Kits",data:[44,55,41,42,22,43,21,35,56,27,43,27]},{name:"Chips",data:[33,21,32,37,23,32,47,31,54,32,20,38]},{name:"Portas",data:[30,25,36,30,45,35,64,51,59,36,39,51]},{name:"Otros",data:[2,0,0,1,1,2,0,0,3,4,1,5]}],chart:{type:"bar",height:360,fontFamily:"Poppins, sans-serif",foreColor:"#8c9097",stacked:!0,toolbar:{show:!1},zoom:{enabled:!0}},grid:{borderColor:"#90A4AE",strokeDashArray:2},dataLabels:{enabled:!1},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],stroke:{show:!0,width:[5,5,5,5],curve:"smooth"},plotOptions:{bar:{columnWidth:"10%",horizontal:!1}},legend:{position:"right",offsetY:40},fill:{opacity:1},legend:{show:!1},tooltip:{enabled:!0,shared:!0,intersect:!1},labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},E={series:[44,55,13,43],chart:{width:220,height:220,type:"pie"},colors:["var(--primary08)","rgba(69, 214, 91, 0.8)","rgba(243, 156, 18, 0.8)","rgba(231, 76, 60, 0.8)"],labels:["Mobile","Desktop","Laptop","Tablet"],legend:{show:!1},stroke:{width:0},dataLabels:{enabled:!0,dropShadow:{enabled:!1}}};if(document.querySelector("#leads-source")){var S=new ApexCharts(document.querySelector("#leads-source"),E);S.render()}if(document.getElementById("tblTelcelCanales")){const e=$("#tblTelcelCanales").DataTable({dom:"Brtip",buttons:["copy","excel","print"],pageLength:10,resposive:!0});Array.from(e.buttons().nodes()).forEach(t=>{t.classList.remove("btn-secondary"),t.classList.add("btn-sm","btn-outline-info","btn-wave","waves-effect","waves-light")}),$("thead",e.table).addClass("text-info"),$(".pagination",e.table).addClass("my-2"),e.buttons().container().appendTo("#btnTelcelCanales"),$("#src_telcel_canal").on("keyup",function(){e.search(this.value).draw()})}function T(e){let r="";switch(e){case"Suspendido":r="warning";break;case"Baja":r="danger";break;default:r="success";break}return r}if(document.getElementById("tblEmpleados")){const e=$("#tblEmpleados").DataTable({dom:"Brtip",buttons:["copy","excel","print"],pageLength:10,resposive:!0,columnDefs:[{targets:3,render:function(t,o,a,s){return`
                    <span class="badge bg-${T(a[3])}-transparent" />
                        ${a[3]}
                    </span>
                    `}}]});Array.from(e.buttons().nodes()).forEach(t=>{t.classList.remove("btn-secondary"),t.classList.add("btn-sm","btn-outline-info","btn-wave","waves-effect","waves-light")}),$("thead",e.table).addClass("text-info"),$(".pagination",e.table).addClass("my-2"),e.buttons().container().appendTo("#tblEmpleadosBtn"),$("#tblEmpleadosInput").on("keyup",function(){e.search(this.value).draw()})}if(document.querySelector("#grafica-activaciones-mensuales")){const e=document.querySelector('meta[name="csrf-token"]').getAttribute("content");fetch("/telcel/activaciones/grafica",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e},body:JSON.stringify({concepto:"canales",descripcion:"desciprciones"})}).then(r=>r.json()).then(r=>{var o={series:r.map(s=>({name:s.concepto,data:s.data})),chart:{type:"bar",height:360,fontFamily:"Poppins, sans-serif",foreColor:"#8c9097",stacked:!0,toolbar:{show:!1},zoom:{enabled:!0}},grid:{borderColor:"#90A4AE",strokeDashArray:2},dataLabels:{enabled:!1},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],stroke:{show:!0,width:[5,5,5,5],curve:"smooth"},plotOptions:{bar:{columnWidth:"10%",horizontal:!1}},legend:{position:"right",offsetY:40},fill:{opacity:1},legend:{show:!1},tooltip:{enabled:!0,shared:!0,intersect:!1},labels:["Ene","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},a=new ApexCharts(document.querySelector("#grafica-activaciones-mensuales"),o);a.render()}),fetch("/telcel/activaciones/compara",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e},body:JSON.stringify({concepto:"canales",descripcion:"desciprciones"})}).then(r=>r.json()).then(r=>{console.log(r.current);const t=r.current.map((o,a)=>{const s=r.last.find(l=>l.concepto===o.concepto);return s&&`${s.data.reduce((l,p)=>l+p,0)}`,console.log(o,s),`
            <div class="d-flex align-items-center me-5">
                <span class="fs-8 text-primary">
                    <i class="mdi mdi-circle"></i>
                </span>
                <div class="ms-2">
                    <p class="mb-0 fs-15    ">${o.data.reduce((l,p)=>l+p,0)}</p>
                    <div class="d-flex align-items-center">
                        <p class="mb-0 me-2 fs-13 text-muted">${o.concepto}</p>
                        ${lastTotalSpan??""} 
                    </div>
                </div>
            </div>
            `});document.getElementById("comparaMensual").innerHTML=t.join("")})}document.querySelectorAll("textarea.noenter").forEach(e=>{e.addEventListener("keydown",r=>{r.key==="Enter"&&r.preventDefault()})});document.querySelectorAll('[type="submit"].btn-submit').forEach(e=>{e.addEventListener("click",r=>{e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span> Guardando...',e.disabled=!0,e.closest("form").submit()}),console.log(e)});document.querySelectorAll("input.importe").forEach(e=>{e.addEventListener("input",r=>{const t=r.target.value;/^[0-9.]*$/.test(t)||(r.target.value=t.replace(/[^0-9.]/g,""))})});document.querySelectorAll("input.numeros").forEach(e=>{e.addEventListener("input",r=>{const t=r.target.value;/^[0-9]*$/.test(t)||(r.target.value=t.replace(/[^0-9]/g,""));const a=r.target.getAttribute("maxlength");a&&t.length>a&&(r.target.value=t.slice(0,a))})});document.querySelectorAll("input.upper").forEach(e=>{e.addEventListener("input",r=>{const t=r.target.value;r.target.value=t.toUpperCase()})});
