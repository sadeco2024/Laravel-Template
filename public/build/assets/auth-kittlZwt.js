window.saveLink=function(e){console.log(e);const o=e.getAttribute("data-link");e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>',e.disabled=!0,fetch(o).then(t=>t.json()).then(t=>{if(console.log(t,t.status),t.form&&typeof t.form=="object")for(let r in t.form){let a=t.form[r];document.getElementsByName(r)[0].value=a}if(t.table&&typeof t.table=="object")for(let r in t.table){let s=document.getElementById(r).getElementsByTagName("tbody")[0];s.innerHTML="",Array.isArray(t.table[r])&&t.table[r].forEach(l=>{let d=s.insertRow();for(let f in l){let p=d.insertCell();p.innerHTML=l[f]}})}try{Swal.fire({position:"center",icon:t.status>0?"error":"success",title:t.msg??(t.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}e.innerHTML=e.data.btnhtml,e.disabled=!1}).catch(t=>{console.error("Error:",t)})};document.querySelectorAll(".sd-modalForm").forEach(e=>{const o=document.querySelector(".modal-body"),t=document.querySelector(".modal-title");e.addEventListener("show.bs.modal",function(r){const a=r.relatedTarget,s=a.getAttribute("data-url"),l=a.getAttribute("data-title"),d=a.getAttribute("data-param");t.textContent=l,o.innerHTML="",fetch(s).then(f=>f.text()).then(f=>{o.innerHTML=f;const p=o.querySelector("form"),g=document.createElement("input");if(g.type="hidden",g.name="param",g.value=d,!p)throw new Error("Error: Falta el <form> en la vista");p.appendChild(g),p.addEventListener("submit",function(w){w.preventDefault();const i=document.querySelector(".modal-footer").querySelector('[type="submit"]');i.data={btnhtml:i.innerHTML},i.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...',i.disabled=!0,fetch(p.action,{method:p.method,body:new FormData(p)}).then(n=>n.json()).then(n=>{if(console.log(n),L(),n.table&&typeof n.table=="object"){console.log(n.table,typeof n.table);for(let c in n.table){let m=document.getElementById(c);console.log("render",m);let b=m.getElementsByTagName("tbody")[0];if(b.innerHTML="",Array.isArray(n.table[c]))n.table[c].forEach(u=>{let h=b.insertRow();console.log("row:",h);for(let y in u){let A=h.insertCell();A.innerHTML=u[y]}});else if(typeof n.table[c]=="object"){console.log(Object.values(n.table[c])),n.table[c]=Object.values(n.table[c]);let u=b.insertRow();n.table[c].forEach(h=>{console.log("row:",u);let y=u.insertCell();y.innerHTML=h})}else console.log("type:",typeof n.table)}}if(n.alert){try{Swal.fire({position:"center",icon:n.status>0?"error":"success",title:n.msg??(n.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}i.innerHTML=i.data.btnhtml,i.disabled=!1}if(n.redirect)n.alert||(window.location.href=n.redirect);else if(i.innerHTML=i.data.btnhtml,i.disabled=!1,n.errors){const c=n.errors;for(const m in c){const b=c[m][0],u=document.createElement("small");u.classList.add("text-sm","text-danger","text-muted","invalid"),u.textContent=b;const h=document.getElementsByName(m)[0];h.classList.add("is-invalid"),h.closest(".input-group").insertAdjacentElement("afterend",u)}}}).catch(n=>{i.innerHTML=i.data.btnhtml,i.disabled=!1,console.error("Error:",n)})})})})});function L(){document.querySelectorAll("small.invalid").forEach(o=>{o.remove()}),document.querySelectorAll("form .is-invalid").forEach(o=>{o.classList.remove("is-invalid")})}document.querySelectorAll(".save").forEach(e=>{e.addEventListener("click",o=>{o.preventDefault(),e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...',e.disabled=!0;const t=e.closest("form");fetch(t.action,{method:t.method,body:new FormData(t)}).then(r=>r.json()).then(r=>{e.innerHTML=e.data.btnhtml,e.disabled=!1;try{console.log(r.status),Swal.fire({position:"center",icon:r.status>0?"error":"success",title:r.msg!==""?r.msg:r.status>0?"Operación NO realizada.":"Operación realizada con éxito.",showConfirmButton:!1,timer:1500})}catch(a){throw new Error("Mensaje: "+a.message)}}).catch(r=>{e.innerHTML=e.data.btnhtml,e.disabled=!1,console.error("Error:",r)})})});document.querySelectorAll(".save-link").forEach(e=>{e.addEventListener("click",o=>{o.preventDefault(),console.log(e);const t=e.getAttribute("data-link");e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>',e.disabled=!0,fetch(t).then(r=>r.json()).then(r=>{try{Swal.fire({position:"center",icon:r.status>0?"error":"success",title:r.msg??(r.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}e.innerHTML=e.data.btnhtml,e.disabled=!1}).catch(r=>{console.error("Error:",r)})})});document.querySelectorAll("input.daterange").forEach(e=>{try{flatpickr(e,{mode:"range",dateFormat:"d-m-Y",locale:"es"})}catch{throw"Error al cargar el datepicker"}});document.querySelectorAll(".confirm-delete").forEach(e=>{e.addEventListener("click",o=>{o.preventDefault();let t=e.closest("form");try{Swal.fire({title:e.dataset.title||"¿Esta usted seguro?",text:e.dataset.text||"Esta acción no se puede deshacer",icon:e.dataset.icon||"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:e.dataset.btntext||"Eliminar"}).then(r=>{r.isConfirmed&&(Swal.fire("Eliminado!","El registro ha sido eliminad.","success"),t.submit())})}catch{throw new Error("Error: Falta librería SweetAlerts2")}})});document.querySelectorAll(".rhExtras").forEach(e=>{e.addEventListener("click",o=>{o.preventDefault();let t=e.closest("div.input-group");t=t.querySelector("select");const r=document.querySelector('meta[name="csrf-token"]').getAttribute("content");Swal.fire({title:"¿Nombre del "+e.dataset.concepto+"?",input:"text",inputAttributes:{autocapitalize:"on"},showCancelButton:!0,confirmButtonText:"Guardar",showLoaderOnConfirm:!0,preConfirm:a=>fetch("/generales/setRhExtras",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r},body:JSON.stringify({concepto:e.dataset.concepto,descripcion:a})}).then(s=>s.ok?s.json():s.json().then(l=>{throw console.log(l.message),new Error(l.message)})).catch(s=>{Swal.showValidationMessage(`${s}`)}),allowOutsideClick:()=>!Swal.isLoading()}).then(a=>{if(a.isConfirmed){Swal.fire({position:"center",icon:"success",title:"El concepto ha sido agregado.",showConfirmButton:!1,timer:1500});let s=document.createElement("option");s.text=a.value.descripcion,s.value=a.value.id,t.add(s),t.value=a.value.id}})})});var E={series:[{name:"Kits",data:[44,55,41,42,22,43,21,35,56,27,43,27]},{name:"Chips",data:[33,21,32,37,23,32,47,31,54,32,20,38]},{name:"Portas",data:[30,25,36,30,45,35,64,51,59,36,39,51]},{name:"Otros",data:[2,0,0,1,1,2,0,0,3,4,1,5]}],chart:{type:"bar",height:360,fontFamily:"Poppins, sans-serif",foreColor:"#8c9097",stacked:!0,toolbar:{show:!1},zoom:{enabled:!0}},grid:{borderColor:"#90A4AE",strokeDashArray:2},dataLabels:{enabled:!1},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],stroke:{show:!0,width:[5,5,5,5],curve:"smooth"},plotOptions:{bar:{columnWidth:"10%",horizontal:!1}},legend:{position:"right",offsetY:40},fill:{opacity:1},legend:{show:!1},tooltip:{enabled:!0,shared:!0,intersect:!1},labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},E={series:[44,55,13,43],chart:{width:220,height:220,type:"pie"},colors:["var(--primary08)","rgba(69, 214, 91, 0.8)","rgba(243, 156, 18, 0.8)","rgba(231, 76, 60, 0.8)"],labels:["Mobile","Desktop","Laptop","Tablet"],legend:{show:!1},stroke:{width:0},dataLabels:{enabled:!0,dropShadow:{enabled:!1}}};if(document.querySelector("#leads-source")){var S=new ApexCharts(document.querySelector("#leads-source"),E);S.render()}if(document.getElementById("tblTelcelCanales")){const e=$("#tblTelcelCanales").DataTable({dom:"Brtip",buttons:["copy","excel","print"],pageLength:10,resposive:!0});Array.from(e.buttons().nodes()).forEach(t=>{t.classList.remove("btn-secondary"),t.classList.add("btn-sm","btn-outline-info","btn-wave","waves-effect","waves-light")}),$("thead",e.table).addClass("text-info"),$(".pagination",e.table).addClass("my-2"),e.buttons().container().appendTo("#btnTelcelCanales"),$("#src_telcel_canal").on("keyup",function(){e.search(this.value).draw()})}function T(e){let o="";switch(e){case"Suspendido":o="warning";break;case"Baja":o="danger";break;default:o="success";break}return o}if(document.getElementById("tblEmpleados")){const e=$("#tblEmpleados").DataTable({dom:"Brtip",buttons:["copy","excel","print"],pageLength:10,resposive:!0,columnDefs:[{targets:3,render:function(t,r,a,s){return`
                    <span class="badge bg-${T(a[3])}-transparent" />
                        ${a[3]}
                    </span>
                    `}}]});Array.from(e.buttons().nodes()).forEach(t=>{t.classList.remove("btn-secondary"),t.classList.add("btn-sm","btn-outline-info","btn-wave","waves-effect","waves-light")}),$("thead",e.table).addClass("text-info"),$(".pagination",e.table).addClass("my-2"),e.buttons().container().appendTo("#tblEmpleadosBtn"),$("#tblEmpleadosInput").on("keyup",function(){e.search(this.value).draw()})}(function(){if(document.querySelector("#slcActivacionesAnio")){const e=document.querySelector("#slcActivacionesAnio"),o=document.querySelector("#slcActivacionesFecha");e.addEventListener("change",t=>{const r=document.querySelector("#slcActivacionesFecha");v(t.target.value,r.value)}),o.addEventListener("change",t=>{const r=document.querySelector("#slcActivacionesAnio");console.log("porfecha"),v(r.value,t.target.value)}),console.log(e.value,o.value),v(e.value,o.value)}})();function v(e,o){if(document.querySelector("#grafica-activaciones-mensuales")){const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");fetch("/telcel/activaciones/grafica",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t},body:JSON.stringify({anio:e??new Date().getFullYear(),tipofecha:o??"preactivacion"})}).then(r=>r.json()).then(r=>{const a=r.map(d=>({name:d.concepto,data:d.data}));var s={series:a,chart:{type:"bar",height:360,fontFamily:"Poppins, sans-serif",foreColor:"#8c9097",stacked:!0,toolbar:{show:!1},zoom:{enabled:!1}},grid:{borderColor:"#90A4AE",strokeDashArray:2},dataLabels:{enabled:!1},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],stroke:{show:!0,width:[5,5,5,5,5,5,5,5,5,5],curve:"smooth"},plotOptions:{bar:{columnWidth:"30%",horizontal:!1}},legend:{position:"right",offsetY:40},fill:{opacity:1},legend:{show:!0},tooltip:{enabled:!0,shared:!0,intersect:!1},colors:["var(--primary-color)","#FFA500","#00FFFF","#FFFF00","#0000FF","#00FF00","#FF00FF","#FF1493","#32CD32","#800080","#FF0000"],labels:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],noData:{text:"No hay datos para mostrar"}};const l=document.querySelector("#grafica-activaciones-mensuales");l.chartInstance?l.chartInstance.updateSeries(a):(l.chartInstance=new ApexCharts(document.querySelector("#grafica-activaciones-mensuales"),s),l.chartInstance.render())}),fetch("/telcel/activaciones/compara",{method:"post",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t},body:JSON.stringify({anio:e??new Date().getFullYear(),tipofecha:o??"preactivacion"})}).then(r=>r.json()).then(r=>{console.log(r);const a=document.getElementById("spnTotalActivas"),s=document.getElementById("liActivaSucursales");s.innerHTML="",a.innerHTML=r.totalActivaciones,r.results.forEach(l=>{const d=document.createElement("li");d.classList.add("mb-2");let f=`
                            <div class="d-flex align-items-center flex-wrap">
                    
                            <div class="flex-fill">
                                <span class="fs-14 d-block mb-1">   ${l.sucursal}</span>
                                <span class="text-muted fs-12"></span>
                            </div>
                            <div>
                                <span class="bg-success-transparent">   ${l.total}</span>
                            </div>
                        </div>
                    `;d.innerHTML=f,console.log(d),s.appendChild(d)})})}}document.querySelectorAll("textarea.noenter").forEach(e=>{e.addEventListener("keydown",o=>{o.key==="Enter"&&o.preventDefault()})});document.querySelectorAll('[type="submit"].btn-submit').forEach(e=>{e.addEventListener("click",o=>{e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span> Guardando...',e.disabled=!0,e.closest("form").submit()}),console.log(e)});document.querySelectorAll("input.importe").forEach(e=>{e.addEventListener("input",o=>{const t=o.target.value;/^[0-9.]*$/.test(t)||(o.target.value=t.replace(/[^0-9.]/g,""))})});document.querySelectorAll("input.numeros").forEach(e=>{e.addEventListener("input",o=>{const t=o.target.value;/^[0-9]*$/.test(t)||(o.target.value=t.replace(/[^0-9]/g,""));const a=o.target.getAttribute("maxlength");a&&t.length>a&&(o.target.value=t.slice(0,a))})});document.querySelectorAll("input.upper").forEach(e=>{e.addEventListener("input",o=>{const t=o.target.value;o.target.value=t.toUpperCase()})});
