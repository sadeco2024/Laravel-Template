document.querySelectorAll(".sd-modalForm").forEach(e=>{const t=document.querySelector(".modal-body"),o=document.querySelector(".modal-title");e.addEventListener("show.bs.modal",function(r){const n=r.relatedTarget,a=n.getAttribute("data-url"),c=n.getAttribute("data-title"),u=n.getAttribute("data-param");o.textContent=c,t.innerHTML="",fetch(a).then(f=>f.text()).then(f=>{t.innerHTML=f;const l=t.querySelector("form"),d=document.createElement("input");if(d.type="hidden",d.name="param",d.value=u,!l)throw new Error("Error: Falta el <form> en la vista");l.appendChild(d),l.addEventListener("submit",function(h){h.preventDefault();const i=document.querySelector(".modal-footer").querySelector('[type="submit"]');i.data={btnhtml:i.innerHTML},i.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Procesando...',i.disabled=!0,fetch(l.action,{method:l.method,body:new FormData(l)}).then(s=>s.json()).then(s=>{if(y(l),s.table&&E(s.table),s.errors&&w(s.errors),s.redirect&&(window.location.href=s.redirect),s.datatable){const b=$("#tblTelcelCanales").DataTable();p(b,s.datatable)}m(s),console.log("form",s),i.innerHTML=i.data.btnhtml,i.disabled=!1}).catch(s=>{i.innerHTML=i.data.btnhtml,i.disabled=!1,m(s)})})})})});function p(e,t){e.row(t.id-1).data(),e.row(t.id-1).data(t)}function y(e){e.querySelectorAll("small.invalid").forEach(o=>{o.remove()}),e.querySelectorAll("form .is-invalid").forEach(o=>{o.classList.remove("is-invalid")})}function E(e){if(console.log(e),e&&typeof e=="object"){console.log(e,typeof e);for(let t in e){let r=document.getElementById(t).getElementsByTagName("tbody")[0];if(Array.isArray(e[t]))e[t].forEach(n=>{let a=r.insertRow();for(let c in n){let u=a.insertCell();u.innerHTML=n[c]}});else if(typeof e[t]=="object"){e[t]=Object.values(e[t]);let n=r.insertRow();e[t].forEach(a=>{let c=n.insertCell();c.innerHTML=a})}else throw console.log("type:",typeof e),new Error("Error: El tipo de dato no es un array o un objeto")}}}function m(e){e.status=e.status??1;let t=e.msg??e.alert??(e.status==0?"Operación NO realizada.":"Operación realizada con éxito.");try{Swal.fire({position:"center",icon:e.status>0?"error":"success",title:t,showConfirmButton:!1,timer:1500})}catch{throw new Error("Alert::error: Falta librería SweetAlerts2")}}function w(e){for(const t in e){const o=e[t][0],r=document.createElement("small");r.classList.add("text-sm","text-danger","text-muted","invalid"),r.textContent=o;const n=document.getElementsByName(t)[0];n.classList.add("is-invalid"),n.closest(".input-group").insertAdjacentElement("afterend",r)}}document.querySelectorAll(".save").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Guardando...',e.disabled=!0;const o=e.closest("form");fetch(o.action,{method:o.method,body:new FormData(o)}).then(r=>r.json()).then(r=>{e.innerHTML=e.data.btnhtml,e.disabled=!1;try{Swal.fire({position:"center",icon:r.status>0?"error":"success",title:r.msg!==""?r.msg:r.status>0?"Operación NO realizada.":"Operación realizada con éxito.",showConfirmButton:!1,timer:1500})}catch(n){throw new Error("Mensaje: "+n.message)}}).catch(r=>{e.innerHTML=e.data.btnhtml,e.disabled=!1,console.error("Error:",r)})})});document.querySelectorAll(".save-link").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const o=e.getAttribute("data-link");e.data={btnhtml:e.innerHTML},e.innerHTML='<span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>',e.disabled=!0,fetch(o).then(r=>r.json()).then(r=>{try{Swal.fire({position:"center",icon:r.status>0?"error":"success",title:r.msg??(r.status?"Operación NO realizada.":"Operación realizada con éxito."),showConfirmButton:!1,timer:1500})}catch{throw new Error("Error: Falta librería SweetAlerts2")}e.innerHTML=e.data.btnhtml,e.disabled=!1}).catch(r=>{console.error("Error:",r)})})});
